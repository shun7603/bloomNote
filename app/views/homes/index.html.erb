<%= javascript_importmap_tags "home" %>

<%= turbo_frame_tag "flash" do %>
  <%= render "shared/flash" %>
<% end %>
<div class="container p-3" style="max-width: 420px; background-color: #fffefc; border-radius: 20px; border: 1px solid #ddd;">
  <!-- üåü „Éò„ÉÉ„ÉÄ„Éº‚îÄÂÖ±ÈÄö -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="fw-bold">BloomNote</h3>
    <div class="dropdown">
      <button class="btn" type="button" id="settingsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <i class="bi bi-list fs-3"></i>
      </button>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="settingsDropdown">
        <% if user_signed_in? %>
          <li><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#addCareRelationshipModal">‰øùËÇ≤ËÄÖ„ÇíËøΩÂä†</button></li>
          <li><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#careRelationshipListModal">Èñ¢‰øÇËÄÖ‰∏ÄË¶ß</button></li>
          <li><button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#switchStatusModal">„Çπ„ÉÜ„Éº„Çø„ÇπÂàáÊõø</button></li>
          <li><hr class="dropdown-divider"></li>
          <li>
            <%= button_to "„É≠„Ç∞„Ç¢„Ç¶„Éà", destroy_user_session_path, method: :delete, data: { turbo: true }, form: { class: "d-inline" }, class: "dropdown-item text-danger" %>
          </li>
        <% else %>
          <li><%= link_to "Êñ∞Ë¶èÁôªÈå≤", new_user_registration_path, class: "dropdown-item" %></li>
          <li><%= link_to "„É≠„Ç∞„Ç§„É≥", new_user_session_path, class: "dropdown-item" %></li>
        <% end %>
      </ul>
    </div>
  </div>

  <% if @children.blank? %>
    <!-- üü° Â≠ê„Å©„ÇÇÊú™ÁôªÈå≤ÊôÇ -->
    <div class="text-center">
      <p class="text-muted">„Åæ„Åö„ÅØÂ≠ê„Å©„ÇÇ„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
      <button class="btn btn-primary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#childModal">Ôºã Â≠ê„Å©„ÇÇÁôªÈå≤</button>
    </div>
  <% else %>
    <!-- üü¢ Â≠ê„Å©„ÇÇÁôªÈå≤Ê∏à„ÅøÊôÇ -->
    <div class="text-center my-3">
      <button class="btn btn-outline-primary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#childModal">Ôºã Â≠ê„Å©„ÇÇÁôªÈå≤</button>
      <button class="btn btn-outline-success rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#routineModal">Ôºã „É´„Éº„ÉÜ„Ç£„É≥ËøΩÂä†</button>
      <button class="btn btn-outline-secondary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#editChildModal">‚öô Â≠ê„Å©„ÇÇÁ∑®ÈõÜ</button>
    </div>

    <!-- üìÜ Êó•‰ªòÂàáÊõø„Åà„Éï„Ç©„Éº„É† -->
    <%= form_with url: root_path, method: :get, local: true, class: "mb-3" do %>
      <div class="d-flex align-items-center">
        <%= label_tag :date, "Ë°®Á§∫„Åô„ÇãÊó•‰ªò", class: "me-2 fw-bold" %>
        <%= date_field_tag :date, @selected_date, class: "form-control w-auto" %>
        <%= submit_tag "Ë°®Á§∫", class: "btn btn-outline-primary ms-2" %>
      </div>
    <% end %>
  <% end %>
</div>

<!-- üìã ‰ªäÊó•„ÅÆË®òÈå≤‰∏ÄË¶ß -->
<h5 class="fw-bold mb-2">
  Ë®òÈå≤‰∏ÄË¶ßÔºà<%= @selected_date&.strftime('%YÂπ¥%mÊúà%dÊó•') || "Êó•‰ªò‰∏çÊòé" %>Ôºâ
</h5>

<ul class="list-group">
  <% @records.each do |record| %>
    <li class="list-group-item d-flex justify-content-between align-items-start">
      <div>
        <strong><%= record.recorded_at.strftime('%H:%M') %></strong>„ÄÄ
        <%= icon_for(record.record_type) %>
        <%= I18n.t("activerecord.attributes.record.record_type.#{record.record_type}") %>
        Ôºà<%= I18n.t("activerecord.attributes.record.category.#{record.category}") %>Ôºâ
        <%= record.quantity %>
        <% if record.memo.present? %>
          <span class="text-muted">- <%= record.memo %></span>
        <% end %>
      </div>
      <div>
        <%= link_to "Á∑®ÈõÜ", "#", class: "btn btn-sm btn-outline-secondary", data: { bs_toggle: "modal", bs_target: "#editRecordModal-#{record.id}" } %>
        <%= button_to "ÂâäÈô§", child_record_path(record.child, record), method: :delete, data: { confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" }, class: "btn btn-sm btn-outline-danger" %>
      </div>
    </li>
    <div class="modal fade" id="editRecordModal-<%= record.id %>" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <%= form_with(model: [record.child, record], local: true) do |f| %>
            <div class="modal-header">
              <h5 class="modal-title">Ë®òÈå≤„ÇíÁ∑®ÈõÜ</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <%= f.label :record_type, "Ë®òÈå≤„ÅÆÁ®ÆÈ°û" %>
              <%= f.select :record_type, Record.record_types.keys.map { |k| [I18n.t("activerecord.attributes.record.record_type.#{k}"), k] }, {}, class: "form-select mb-2" %>
              <%= f.label :category, "„Ç´„ÉÜ„Ç¥„É™" %>
              <%= f.select :category, Record.categories.keys.map { |k| [I18n.t("activerecord.attributes.record.category.#{k}"), k] }, {}, class: "form-select mb-2" %>
              <%= f.label :quantity, "Èáè„ÇÑÂõûÊï∞" %>
              <%= f.number_field :quantity, class: "form-control mb-2" %>
              <%= f.label :recorded_at, "Êó•ÊôÇ" %>
              <%= f.datetime_local_field :recorded_at, class: "form-control mb-2" %>
              <%= f.label :memo, "„É°„É¢" %>
              <%= f.text_area :memo, class: "form-control", rows: 2 %>
            </div>
            <div class="modal-footer">
              <%= f.submit "Êõ¥Êñ∞", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</ul>

<!-- Á∑äÊÄ•ÈÄ£Áµ°„Éú„Çø„É≥ -->
<div class="bg-light rounded p-2 my-3 d-flex align-items-center" role="button" data-bs-toggle="modal" data-bs-target="#emergencyModal">
  <i class="bi bi-telephone-fill me-2" style="font-size: 1.3rem;"></i>
  <strong>Á∑äÊÄ•ÈÄ£Áµ°</strong>
</div>

<!-- „Ç¢„Ç§„Ç≥„É≥ÈÅ∏Êäû -->
<div class="d-flex justify-content-around my-2">
  <div class="text-center">
    <%= image_tag "milk.png", style: "height: 24px;" %><br>„Éü„É´„ÇØ
  </div>
  <div class="text-center">
    <%= image_tag "sleep.png", style: "height: 24px;" %><br>Áù°Áú†
  </div>
  <div class="text-center">
    <%= image_tag "diaper.png", style: "height: 24px;" %><br>ÊéíÊ≥Ñ
  </div>
</div>

<!-- ‰ªä„ÇÑ„Çã„Åπ„Åç„Çø„Çπ„ÇØ -->
<div class="text-center p-2 rounded mt-3 fw-bold" style="background-color: #fff3cd;">
  ‰ªä„ÇÑ„Çã„Åπ„Åç„Çø„Çπ„ÇØÔºö<%= @next_task || "Êú™ÂÆö" %>
</div>

<!-- „É¢„Éº„ÉÄ„É´„Åü„Å°„ÅØÂàÜÂ≤ê„ÅÆÂ§ñ„ÅßÂ∏∏„Å´Ë°®Á§∫ÂèØËÉΩ„Å´„Åô„Çã -->
<%= render "shared/child_modals" %>
<%= render "shared/routine_modal" %>
<%= render "shared/record_modal" %>

<!-- Â≠ê„Å©„ÇÇÁôªÈå≤„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="childModal" tabindex="-1" aria-labelledby="childModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="childModalLabel">Â≠ê„Å©„ÇÇ„ÇíÁôªÈå≤</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
<%= form_with(model: Child.new, url: children_path, local: true) do |f| %>

  <% if f.object.errors.any? %>
    <div class="alert alert-danger">
      <ul class="mb-2">
        <% f.object.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- „Åì„ÅÆ‰∏ã„Å´ÂÖ•ÂäõÈ†ÖÁõÆ„ÅåÁ∂ö„Åè -->
  <div class="mb-3">
    <%= f.label :name %>
    <%= f.text_field :name, class: "form-control" %>
  </div>
          <div class="mb-3">
            <%= f.label :birth_date %>
            <%= f.date_field :birth_date, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :gender %>
            <%= f.select :gender, [["Áî∑„ÅÆÂ≠ê", "boy"], ["Â•≥„ÅÆÂ≠ê", "girl"]], {}, class: "form-select" %>
          </div>
          <%= f.submit "ÁôªÈå≤", class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Â≠ê„Å©„ÇÇÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="editChildModal" tabindex="-1" aria-labelledby="editChildModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editChildModalLabel">Â≠ê„Å©„ÇÇÊÉÖÂ†±„ÇíÁ∑®ÈõÜ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
          <% if flash[:edit_child_error] %>
    <div class="alert alert-danger">
      <% @child.errors.full_messages.each do |message| %>
        <p><%= message %></p>
      <% end %>
    </div>
  <% end %>

        <% if @children.present? %>
          <%= form_with(model: @children.first, url: child_path(@children.first), method: :patch, local: true) do |f| %>
            <div class="mb-3">
              <%= f.label :name %>
              <%= f.text_field :name, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :birth_date %>
              <%= f.date_field :birth_date, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :gender %>
              <%= f.select :gender, [["Áî∑„ÅÆÂ≠ê", "boy"], ["Â•≥„ÅÆÂ≠ê", "girl"]], {}, class: "form-select" %>
            </div>
            <%= f.submit "Êõ¥Êñ∞", class: "btn btn-primary" %>
          <% end %>
        <% else %>
          <p>Á∑®ÈõÜ„Åß„Åç„ÇãÂ≠ê„Å©„ÇÇ„Åå„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- „É´„Éº„ÉÜ„Ç£„É≥ÁôªÈå≤„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="routineModal" tabindex="-1" aria-labelledby="routineModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="routineModalLabel">„É´„Éº„ÉÜ„Ç£„É≥„ÇíËøΩÂä†</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <% if @children.present? %>
          <%= form_with(model: [@children.first, Routine.new], url: child_routines_path(@children.first), local: true) do |f| %>
            <div class="mb-3">
              <%= f.label :time %>
              <%= f.time_field :time, class: "form-control" %>
            </div>
<div class="mb-3">
  <%= f.label :task, "Ë®òÈå≤„ÅÆÁ®ÆÈ°û" %>
  <%= f.select :task,
        Routine.tasks.map { |key, label| [label, key] },
        { prompt: "ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ" },
        class: "form-select" %>
</div>
            <div class="mb-3">
              <%= f.label :category %>
              <%= f.select :category, Routine.categories.map { |k,v| [v, k] }, {}, class: "form-select" %>
            </div>
            <div class="mb-3">
              <%= f.label :memo %>
              <%= f.text_area :memo, class: "form-control" %>
            </div>
            <%= f.submit "ËøΩÂä†", class: "btn btn-success" %>
          <% end %>
        <% else %>
          <p>Â≠ê„Å©„ÇÇ„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- „É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè„Éú„Çø„É≥ -->
<div class="text-center my-3">
  <button class="btn btn-outline-warning rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#recordModal">Ôºã ËÇ≤ÂÖêË®òÈå≤</button>
</div>

<!-- ËÇ≤ÂÖêË®òÈå≤ÁôªÈå≤„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="recordModalLabel">ËÇ≤ÂÖêË®òÈå≤„ÇíËøΩÂä†</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <% if @children.present? %>
<%= form_with(model: [@children.first, @record || Record.new], url: child_records_path(@children.first), local: true, data: { turbo: false }) do |f| %>            <div class="mb-3">
  <% if f.object.errors.any? %>
  <div class="alert alert-danger">
    <ul class="mb-2">
      <% f.object.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>
              <%= f.label :record_type, "Ë®òÈå≤„ÅÆÁ®ÆÈ°û" %>
              <%= f.select :record_type, Record.record_types.map { |k, _| [k.humanize, k] }, {}, class: "form-select" %>
            </div>
            <div class="mb-3">
              <%= f.label :category, "„Ç´„ÉÜ„Ç¥„É™" %>
              <%= f.select :category, Record.categories.map { |k, v| [v, k] }, {}, class: "form-select" %>
            </div>
            <div class="mb-3">
              <%= f.label :quantity, "Èáè„ÇÑÂõûÊï∞" %>
              <%= f.number_field :quantity, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :recorded_at, "Ë®òÈå≤Êó•ÊôÇ" %>
              <%= f.datetime_local_field :recorded_at, value: Time.current.strftime("%Y-%m-%dT%H:%M"), class: "form-control" %>            </div>
            <div class="mb-3">
              <%= f.label :memo, "„É°„É¢" %>
              <%= f.text_area :memo, class: "form-control", rows: 2 %>
            </div>
            <div class="text-end">
              <%= f.submit "Ë®òÈå≤„Åô„Çã", class: "btn btn-primary" %>
            </div>
          <% end %>
        <% else %>
          <p>„Åæ„ÅöÂ≠ê„Å©„ÇÇ„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>


<!-- Á∑äÊÄ•ÈÄ£Áµ°„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="emergencyModal" tabindex="-1" aria-labelledby="emergencyModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- „É¢„Éº„ÉÄ„É´„Éò„ÉÉ„ÉÄ„Éº -->
      <div class="modal-header">
        <h5 class="modal-title" id="emergencyModalLabel">Á∑äÊÄ•ÈÄ£Áµ°ÂÖà</h5>
        <button class="btn btn-sm btn-outline-primary ms-3" data-bs-toggle="modal" data-bs-target="#newHospitalModal">ÔºãÁóÖÈô¢„ÇíËøΩÂä†</button>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
      </div>

      <!-- „É¢„Éº„ÉÄ„É´„Éú„Éá„Ç£ -->
      <div class="modal-body">
        <% if current_user.hospitals.any? %>
          <% current_user.hospitals.each do |hospital| %>
            <div class="border rounded p-2 mb-3">
              <p>
                <strong><%= hospital.name %></strong><br>
                <%= link_to hospital.phone_number, "tel:#{hospital.phone_number}", class: "btn btn-outline-danger btn-sm mt-1" %>
              </p>
              <!-- Á∑®ÈõÜ„Éú„Çø„É≥ -->
              <button class="btn btn-sm btn-outline-secondary"
                      data-bs-dismiss="modal"
                      data-bs-toggle="modal"
                      data-bs-target="#editHospitalModal-<%= hospital.id %>">
                Á∑®ÈõÜ
              </button>
            </div>
          <% end %>
        <% else %>
          <div class="text-muted">ÁôªÈå≤„Åï„Çå„ÅüÁóÖÈô¢ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- ÁóÖÈô¢ÊÉÖÂ†± Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
<% current_user.hospitals.each do |hospital| %>
  <% hospital = @hospital if flash[:hospital_modal_error].to_i == hospital.id %>
  <div class="modal fade"
       id="editHospitalModal-<%= hospital.id %>"
       tabindex="-1"
       aria-labelledby="editHospitalModalLabel-<%= hospital.id %>"
       aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <%= form_with(model: hospital, url: hospital_path(hospital), method: :patch, local: true) do |f| %>
        <% if flash[:hospital_errors] && flash[:hospital_modal_error].to_i == hospital.id %>
          <div class="alert alert-danger">
            <ul>
              <% flash[:hospital_errors].each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

          <div class="modal-header">
            <h5 class="modal-title" id="editHospitalModalLabel-<%= hospital.id %>">Á∑äÊÄ•ÈÄ£Áµ°ÊÉÖÂ†±„ÇíÁ∑®ÈõÜ</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
          </div>
          <div class="modal-body">
            <% if hospital.errors.any? %>
              <div class="alert alert-danger">
                <ul>
                  <% hospital.errors.full_messages.each do |msg| %>
                    <li><%= msg %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="mb-3">
              <%= f.label :name, "Á∑äÊÄ•ÈÄ£Áµ°ÂÖà„ÉªÁóÖÈô¢" %>
              <%= f.text_field :name, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :phone_number, "ÈõªË©±Áï™Âè∑" %>
              <%= f.telephone_field :phone_number, class: "form-control" %>
            </div>
          </div>
          <div class="modal-footer">
            <%= f.submit "Êõ¥Êñ∞„Åô„Çã", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>

<!-- ÁóÖÈô¢ÊÉÖÂ†± Êñ∞Ë¶èËøΩÂä†„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="newHospitalModal" tabindex="-1" aria-labelledby="newHospitalModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <%= form_with(model: current_user.hospitals.build, local: true) do |f| %>
        <div class="modal-header">
          <h5 class="modal-title" id="newHospitalModalLabel">Á∑äÊÄ•ÈÄ£Áµ°Âêç„ÇíËøΩÂä†</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <%= f.label :name, "ÁóÖÈô¢Âêç" %>
            <%= f.text_field :name, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :phone_number, "ÈõªË©±Áï™Âè∑" %>
            <%= f.telephone_field :phone_number, class: "form-control" %>
          </div>
        </div>
        <div class="modal-footer">
          <%= f.submit "ËøΩÂä†„Åô„Çã", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- „Ç®„É©„ÉºÁô∫ÁîüÊôÇ„Å´ÂØæË±°„ÅÆÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´„ÇíËá™Âãï„ÅßÈñã„Åè -->
<% if flash[:hospital_modal_error] %>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const modal = new bootstrap.Modal(document.getElementById("editHospitalModal-<%= flash[:hospital_modal_error] %>"));
      modal.show();
    });
  </script>
<% end %>
<div class="modal fade" id="addCareRelationshipModal" tabindex="-1" aria-labelledby="addCareRelationshipModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
<%= form_with model: CareRelationship.new, url: care_relationships_path, local: true do |f| %>
        <div class="modal-header">
          <h5 class="modal-title" id="addCareRelationshipModalLabel">‰øùËÇ≤ËÄÖ„ÇíËøΩÂä†</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
        </div>
        <div class="modal-body">
<% if flash[:care_relationship_errors] %>
  <div class="alert alert-danger">
    <ul class="mb-0">
      <% flash[:care_relationship_errors].each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

          <div class="mb-3">
            <%= f.label :child_id, "Â≠ê„Å©„ÇÇ" %>
<%= f.select :child_id, @children.map { |c| [c.name, c.id] }, {}, class: "form-select" %>

          </div>
          <div class="mb-3">
            <%= f.label :caregiver_id, "‰øùËÇ≤ËÄÖÔºà„É°„Éº„É´„Å™„Å©Ôºâ" %>
<%= f.text_field :caregiver_email, class: "form-control" %>
          </div>
        </div>
        <div class="modal-footer">
          <%= f.submit "ËøΩÂä†", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
<% if flash[:open_modal] %>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const modal = new bootstrap.Modal(document.getElementById("<%= flash[:open_modal] %>"));
      modal.show();
    });
  </script>
<% end %>
<!-- Èñ¢‰øÇËÄÖ‰∏ÄË¶ß„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="careRelationshipListModal" tabindex="-1" aria-labelledby="careRelationshipListModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- „É¢„Éº„ÉÄ„É´„Éò„ÉÉ„ÉÄ„Éº -->
      <div class="modal-header">
        <h5 class="modal-title" id="careRelationshipListModalLabel">Èñ¢‰øÇËÄÖ‰∏ÄË¶ß</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
      </div>

      <!-- „É¢„Éº„ÉÄ„É´„Éú„Éá„Ç£ -->
      <div class="modal-body">
        <% if @care_relationships.present? && @care_relationships.any? %>
          <table class="table table-hover table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>Â≠ê„Å©„ÇÇ</th>
                <th>Ë¶™</th>
                <th>‰øùËÇ≤ËÄÖ</th>
                <th class="text-center">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
              </tr>
            </thead>
            <tbody>
              <% @care_relationships.each do |rel| %>
                <tr>
                  <td><%= rel.child.name %></td>
                  <td><%= rel.parent.nickname %></td>
                  <td><%= rel.caregiver.nickname %></td>
                  <td class="text-center">
                    <% if rel.ongoing? %>
                      <span class="badge bg-success">È†ê„Åã„Çä‰∏≠</span>
                    <% else %>
                      <span class="badge bg-secondary">ÁµÇ‰∫Ü</span>
                    <% end %>
                      <% if rel.parent == current_user %>
    <%= button_to "ÂâäÈô§", care_relationship_path(rel),
        method: :delete,
        data: { turbo_confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" },
        class: "btn btn-sm btn-outline-danger mt-2" %>
  <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <p class="text-muted">Èñ¢‰øÇËÄÖ„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂàá„ÇäÊõø„Åà„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="switchStatusModal" tabindex="-1" aria-labelledby="switchStatusModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="switchStatusModalLabel">‰øùËÇ≤„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÂàá„ÇäÊõø„Åà</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
      </div>

      <div class="modal-body">
<!-- „Çπ„ÉÜ„Éº„Çø„ÇπÂàá„ÇäÊõø„Åà„É¢„Éº„ÉÄ„É´ -->
<div class="modal fade" id="switchStatusModal" tabindex="-1" aria-labelledby="switchStatusModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="switchStatusModalLabel">‰øùËÇ≤„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÂàá„ÇäÊõø„Åà</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
      </div>
      <div class="modal-body">
        <% @care_relationships.each do |cr| %>
        <%= render partial: "shared/care_relationship", locals: { care_relationship: cr } %>          
        <% end %>
      </div>
    </div>
  </div>
</div>
