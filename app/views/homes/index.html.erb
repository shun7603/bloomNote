<%= javascript_importmap_tags "home" %>

<% if @children.blank? %>
  <!-- тГљсЂЕсѓѓТюфуЎ╗жї▓сЂ«та┤тљѕсЂ«сЃђсЃЪсЃ╝УАеуц║ -->
  <div class="container p-3" style="max-width: 420px; background-color: #fffefc; border-radius: 20px; border: 1px solid #ddd;">
    <div class="text-center">
      <h3 class="fw-bold">BloomNote</h3>
      <p class="text-muted">сЂЙсЂџсЂ»тГљсЂЕсѓѓсѓњуЎ╗жї▓сЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ</p>
      <button class="btn btn-primary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#childModal">№╝І тГљсЂЕсѓѓуЎ╗жї▓</button>
    </div>
  </div>
<% else %>
  <!-- тГљсЂЕсѓѓсЂїуЎ╗жї▓сЂЋсѓїсЂдсЂёсѓІта┤тљѕсЂ«УАеуц║ -->
  <div class="container p-3" style="max-width: 420px; background-color: #fffefc; border-radius: 20px; border: 1px solid #ddd;">

    <!-- сЃўсЃЃсЃђсЃ╝ -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="fw-bold">BloomNote</h3>
      <i class="bi bi-list fs-3"></i>
    </div>

    <h4 class="fw-bold mb-2">сЃФсЃ╝сЃєсѓБсЃ│</h4>


    <!-- ТЕЪУЃйсЃюсѓ┐сЃ│ -->
    <div class="text-center my-3">
      <button class="btn btn-outline-primary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#childModal">№╝І тГљсЂЕсѓѓуЎ╗жї▓</button>
      <button class="btn btn-outline-success rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#routineModal">№╝І сЃФсЃ╝сЃєсѓБсЃ│У┐йтіа</button>
      <button class="btn btn-outline-secondary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#editChildModal">РџЎ тГљсЂЕсѓѓуиежЏє</button>
    </div>

<!-- ­ЪЊє ТЌЦС╗ўтѕЄсѓіТЏ┐сЂѕсЃЋсѓЕсЃ╝сЃа -->
<%= form_with url: root_path, method: :get, local: true, class: "mb-3" do %>
  <div class="d-flex align-items-center">
    <%= label_tag :date, "УАеуц║сЂЎсѓІТЌЦС╗ў", class: "me-2 fw-bold" %>
    <%= date_field_tag :date, @selected_date, class: "form-control w-auto" %>
    <%= submit_tag "УАеуц║", class: "btn btn-outline-primary ms-2" %>
  </div>
<% end %>

<!-- ­ЪЊІ С╗іТЌЦсЂ«Уеўжї▓СИђУдД -->
<h5 class="fw-bold mb-2">
  Уеўжї▓СИђУдД№╝ѕ<%= @selected_date&.strftime('%Yт╣┤%mТюѕ%dТЌЦ') || "ТЌЦС╗ўСИЇТўј" %>№╝Ѕ
</h5>

<ul class="list-group">
  <% @records.each do |record| %>
    <li class="list-group-item d-flex justify-content-between align-items-start">
      <div>
        <strong><%= record.recorded_at.strftime('%H:%M') %></strong>сђђ
        <%= icon_for(record.record_type) %>
        <%= I18n.t("activerecord.attributes.record.record_type.#{record.record_type}") %>
        №╝ѕ<%= I18n.t("activerecord.attributes.record.category.#{record.category}") %>№╝Ѕ
        <%= record.quantity %>
        <% if record.memo.present? %>
          <span class="text-muted">- <%= record.memo %></span>
        <% end %>
      </div>
      <div>
        <%= link_to "уиежЏє", "#", class: "btn btn-sm btn-outline-secondary", data: { bs_toggle: "modal", bs_target: "#editRecordModal-#{record.id}" } %>
        <%= button_to "тЅіжЎц", child_record_path(record.child, record), method: :delete,
              data: { confirm: "ТюгтйЊсЂФтЅіжЎцсЂЌсЂЙсЂЎсЂІ№╝Ъ" },
              class: "btn btn-sm btn-outline-danger" %>
      </div>
    </li>

    <!-- РюЈ№ИЈ уиежЏєсЃбсЃ╝сЃђсЃФ -->
    <div class="modal fade" id="editRecordModal-<%= record.id %>" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <%= form_with(model: [record.child, record], local: true) do |f| %>
            <div class="modal-header">
              <h5 class="modal-title">Уеўжї▓сѓњуиежЏє</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <%= f.label :record_type, "Уеўжї▓сЂ«уе«жАъ" %>
              <%= f.select :record_type, Record.record_types.keys.map { |k| [I18n.t("activerecord.attributes.record.record_type.#{k}"), k] }, {}, class: "form-select mb-2" %>

              <%= f.label :category, "сѓФсЃєсѓ┤сЃф" %>
              <%= f.select :category, Record.categories.keys.map { |k| [I18n.t("activerecord.attributes.record.category.#{k}"), k] }, {}, class: "form-select mb-2" %>

              <%= f.label :quantity, "жЄЈсѓётЏъТЋ░" %>
              <%= f.number_field :quantity, class: "form-control mb-2" %>

              <%= f.label :recorded_at, "ТЌЦТЎѓ" %>
              <%= f.datetime_local_field :recorded_at, class: "form-control mb-2" %>

              <%= f.label :memo, "сЃАсЃб" %>
              <%= f.text_area :memo, class: "form-control", rows: 2 %>
            </div>
            <div class="modal-footer">
              <%= f.submit "ТЏ┤Тќ░", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</ul>

<!-- уиіТђЦжђБухАсЃюсѓ┐сЃ│№╝ѕсЃбсЃ╝сЃђсЃФУхитІЋ№╝Ѕ -->
<div class="bg-light rounded p-2 my-3 d-flex align-items-center"
     role="button"
     data-bs-toggle="modal"
     data-bs-target="#emergencyModal">
  <i class="bi bi-telephone-fill me-2" style="font-size: 1.3rem;"></i>
  <strong>уиіТђЦжђБухА</strong>
</div>

    <!-- сѓбсѓцсѓ│сЃ│жЂИТіъ -->
    <div class="d-flex justify-content-around my-2">
      <div class="text-center">
        <%= image_tag "milk.png", style: "height: 24px;" %><br>сЃЪсЃФсѓ»
      </div>
      <div class="text-center">
        <%= image_tag "sleep.png", style: "height: 24px;" %><br>уЮАуюа
      </div>
      <div class="text-center">
        <%= image_tag "diaper.png", style: "height: 24px;" %><br>ТјњТ│ё
      </div>
    </div>

    <!-- С╗ісѓёсѓІсЂ╣сЂЇсѓ┐сѓ╣сѓ» -->
    <div class="text-center p-2 rounded mt-3 fw-bold" style="background-color: #fff3cd;">
      С╗ісѓёсѓІсЂ╣сЂЇсѓ┐сѓ╣сѓ»№╝џ<%= @next_task || "Тюфт«џ" %>
    </div>
  </div>
<% end %>

<!-- сЃбсЃ╝сЃђсЃФсЂЪсЂАсЂ»тѕєт▓љсЂ«тцќсЂДтИИсЂФУАеуц║тЈ»УЃйсЂФсЂЎсѓІ -->
<%= render "shared/child_modals" %>
<%= render "shared/routine_modal" %>
<%= render "shared/record_modal" %>

<!-- тГљсЂЕсѓѓуЎ╗жї▓сЃбсЃ╝сЃђсЃФ -->
<div class="modal fade" id="childModal" tabindex="-1" aria-labelledby="childModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="childModalLabel">тГљсЂЕсѓѓсѓњуЎ╗жї▓</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
<%= form_with(model: Child.new, url: children_path, local: true) do |f| %>

  <% if f.object.errors.any? %>
    <div class="alert alert-danger">
      <ul class="mb-2">
        <% f.object.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- сЂЊсЂ«СИІсЂФтЁЦтіЏжаЁуЏ«сЂїуХџсЂЈ -->
  <div class="mb-3">
    <%= f.label :name %>
    <%= f.text_field :name, class: "form-control" %>
  </div>
          <div class="mb-3">
            <%= f.label :birth_date %>
            <%= f.date_field :birth_date, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :gender %>
            <%= f.select :gender, [["ућисЂ«тГљ", "boy"], ["тЦ│сЂ«тГљ", "girl"]], {}, class: "form-select" %>
          </div>
          <%= f.submit "уЎ╗жї▓", class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- тГљсЂЕсѓѓуиежЏєсЃбсЃ╝сЃђсЃФ -->
<div class="modal fade" id="editChildModal" tabindex="-1" aria-labelledby="editChildModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editChildModalLabel">тГљсЂЕсѓѓТЃЁта▒сѓњуиежЏє</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <% if @children.present? %>
          <%= form_with(model: @children.first, url: child_path(@children.first), method: :patch, local: true) do |f| %>
            <div class="mb-3">
              <%= f.label :name %>
              <%= f.text_field :name, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :birth_date %>
              <%= f.date_field :birth_date, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :gender %>
              <%= f.select :gender, [["ућисЂ«тГљ", "boy"], ["тЦ│сЂ«тГљ", "girl"]], {}, class: "form-select" %>
            </div>
            <%= f.submit "ТЏ┤Тќ░", class: "btn btn-primary" %>
          <% end %>
        <% else %>
          <p>уиежЏєсЂДсЂЇсѓІтГљсЂЕсѓѓсЂїсЂёсЂЙсЂЏсѓЊсђѓ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- сЃФсЃ╝сЃєсѓБсЃ│уЎ╗жї▓сЃбсЃ╝сЃђсЃФ -->
<div class="modal fade" id="routineModal" tabindex="-1" aria-labelledby="routineModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="routineModalLabel">сЃФсЃ╝сЃєсѓБсЃ│сѓњУ┐йтіа</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <% if @children.present? %>
          <%= form_with(model: [@children.first, Routine.new], url: child_routines_path(@children.first), local: true) do |f| %>
            <div class="mb-3">
              <%= f.label :time %>
              <%= f.time_field :time, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :task %>
              <%= f.text_field :task, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :category %>
              <%= f.select :category, Routine.categories.map { |k,v| [v, k] }, {}, class: "form-select" %>
            </div>
            <div class="mb-3">
              <%= f.label :memo %>
              <%= f.text_area :memo, class: "form-control" %>
            </div>
            <%= f.submit "У┐йтіа", class: "btn btn-success" %>
          <% end %>
        <% else %>
          <p>тГљсЂЕсѓѓсЂїуЎ╗жї▓сЂЋсѓїсЂдсЂёсЂЙсЂЏсѓЊсђѓ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- сЃбсЃ╝сЃђсЃФсѓњжќІсЂЈсЃюсѓ┐сЃ│ -->
<div class="text-center my-3">
  <button class="btn btn-outline-warning rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#recordModal">№╝І Уѓ▓тЁљУеўжї▓</button>
</div>

<!-- Уѓ▓тЁљУеўжї▓уЎ╗жї▓сЃбсЃ╝сЃђсЃФ -->
<div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="recordModalLabel">Уѓ▓тЁљУеўжї▓сѓњУ┐йтіа</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <% if @children.present? %>
<%= form_with(model: [@children.first, @record || Record.new], url: child_records_path(@children.first), local: true, data: { turbo: false }) do |f| %>            <div class="mb-3">
  <% if f.object.errors.any? %>
  <div class="alert alert-danger">
    <ul class="mb-2">
      <% f.object.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>
              <%= f.label :record_type, "Уеўжї▓сЂ«уе«жАъ" %>
              <%= f.select :record_type, Record.record_types.map { |k, _| [k.humanize, k] }, {}, class: "form-select" %>
            </div>
            <div class="mb-3">
              <%= f.label :category, "сѓФсЃєсѓ┤сЃф" %>
              <%= f.select :category, Record.categories.map { |k, v| [v, k] }, {}, class: "form-select" %>
            </div>
            <div class="mb-3">
              <%= f.label :quantity, "жЄЈсѓётЏъТЋ░" %>
              <%= f.number_field :quantity, class: "form-control" %>
            </div>
            <div class="mb-3">
              <%= f.label :recorded_at, "Уеўжї▓ТЌЦТЎѓ" %>
              <%= f.datetime_local_field :recorded_at, value: Time.current.strftime("%Y-%m-%dT%H:%M"), class: "form-control" %>            </div>
            <div class="mb-3">
              <%= f.label :memo, "сЃАсЃб" %>
              <%= f.text_area :memo, class: "form-control", rows: 2 %>
            </div>
            <div class="text-end">
              <%= f.submit "Уеўжї▓сЂЎсѓІ", class: "btn btn-primary" %>
            </div>
          <% end %>
        <% else %>
          <p>сЂЙсЂџтГљсЂЕсѓѓсѓњуЎ╗жї▓сЂЌсЂдсЂЈсЂасЂЋсЂёсђѓ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
<!-- уиіТђЦжђБухАсЃбсЃ╝сЃђсЃФ -->
<div class="modal fade" id="emergencyModal" tabindex="-1" aria-labelledby="emergencyModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- сЃбсЃ╝сЃђсЃФсЃўсЃЃсЃђсЃ╝ -->
      <div class="modal-header">
        <h5 class="modal-title" id="emergencyModalLabel">уиіТђЦжђБухАтЁѕ</h5>
        <!-- У┐йтіасЃюсѓ┐сЃ│№╝ѕсЃбсЃ╝сЃђсЃФжќІсЂЈ№╝Ѕ -->
        <button class="btn btn-sm btn-outline-primary ms-3" data-bs-toggle="modal" data-bs-target="#newHospitalModal">№╝ІуЌЁжЎбсѓњУ┐йтіа</button>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="жќЅсЂўсѓІ"></button>
      </div>

      <!-- сЃбсЃ╝сЃђсЃФсЃюсЃЄсѓБ -->
      <div class="modal-body">
        <% if current_user.hospitals.any? %>
<% current_user.hospitals.each do |hospital| %>
  <div class="border rounded p-2 mb-3">
    <p>
      <strong><%= hospital.name %></strong><br>
      <%= link_to hospital.phone_number, "tel:#{hospital.phone_number}", class: "btn btn-outline-danger btn-sm mt-1" %>
    </p>
    <!-- уиежЏєсЃюсѓ┐сЃ│ -->
    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#editHospitalModal-<%= hospital.id %>">уиежЏє</button>
  </div> <!-- Рєљ сЂЊсѓїсЂїТіюсЂЉсЂдсЂЪ№╝Ђ -->
<% end %>
        <% else %>
          <p>уЎ╗жї▓сЂЋсѓїсЂЪуЌЁжЎбТЃЁта▒сЂїсЂѓсѓісЂЙсЂЏсѓЊсђѓ</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="text-end">
  <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#editHospitalModal">У┐йтіасЃ╗уиежЏє</button>
</div>
      </div>
    </div>
  </div>
</div>
<!-- уЌЁжЎбТЃЁта▒ Тќ░УдЈУ┐йтіасЃбсЃ╝сЃђсЃФ -->
<div class="modal fade" id="newHospitalModal" tabindex="-1" aria-labelledby="newHospitalModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <%= form_with(model: current_user.hospitals.build, local: true) do |f| %>
        <div class="modal-header">
          <h5 class="modal-title" id="newHospitalModalLabel">уЌЁжЎбсѓњУ┐йтіа</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <%= f.label :name, "уЌЁжЎбтљЇ" %>
            <%= f.text_field :name, class: "form-control" %>
          </div>
          <div class="mb-3">
            <%= f.label :phone_number, "жЏ╗УЕ▒уЋфтЈи" %>
            <%= f.telephone_field :phone_number, class: "form-control" %>
          </div>
        </div>
        <div class="modal-footer">
          <%= f.submit "У┐йтіасЂЎсѓІ", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>